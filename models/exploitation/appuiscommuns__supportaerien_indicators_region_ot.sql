{# 
Example de profilage incrémental au fil du temps des données d'une source par le profiler de DBT Hub :
#}

{% set prefix = 'appuiscommunssupp' %} -- ?
{% set fieldPrefix = prefix + '__' %}

{# inlined profiled_week else delete fails in incremental phase 1 #}
{{
  config(
    enabled=var("enableProfiling", false) | as_bool,
    materialized="incremental",
    unique_key='concat("profiled_week", "reg_code")'
  )
}}

select
  concat(substr("updated_at"::text, 1, 4), EXTRACT('week' FROM "updated_at")) as "profiled_week", -- '202221'
  *
from {{ ref("appuiscommuns__supportaerien_indicators_region") }}